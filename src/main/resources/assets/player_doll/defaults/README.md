# Player Doll Addon 配置指南

欢迎使用 Player Doll Addon！本目录用于存放玩偶相关的配置文件。

## 目录结构

```
player_doll/
├── png/              # 自定义玩偶皮肤材质目录
├── poses/            # 姿态配置文件目录
├── actions/          # 动作配置文件目录
└── README.md         # 本说明文档
```

## 1. 配置自定义玩偶皮肤

### 步骤

1. **准备皮肤材质文件**
   - 将玩家皮肤 PNG 文件放入 `png/` 目录
   - 文件必须是标准的 Minecraft 玩家皮肤格式（64x64 或 64x32 像素）

2. **文件命名规则**
   - 文件名必须以 `S` 或 `A` 开头，表示模型类型：
     - `S` = 粗手臂模型（Steve 模型）
     - `A` = 细手臂模型（Alex 模型）
   - 第一个字符后的部分将作为玩偶的显示名称
   - 名称处理规则：
     - 单个下划线 `_` 会被替换为空格
     - 双下划线 `__` 会被替换为单个下划线 `_`

3. **命名示例**

| 文件名 | 模型类型 | 显示名称 | 说明 |
|--------|---------|---------|------|
| `SMy_Character.png` | 粗手臂 | `My Character` | 单下划线变为空格 |
| `A123_ABC__qwe.png` | 细手臂 | `123 ABC_qwe` | 单下划线变空格，双下划线变单下划线 |
| `SHero_Doll.png` | 粗手臂 | `Hero Doll` | 单下划线变为空格 |

4. **使用**
   - 启动游戏或重新加载资源包（F3+T）
   - 模组会自动扫描 `png/` 目录并注册所有 PNG 文件
   - 在创造模式物品栏的"玩家玩偶"标签页中找到新注册的玩偶物品

## 2. 配置姿态（Poses）

姿态定义了玩偶的静态姿势，保存在 `poses/` 目录下。

### 姿态文件格式

每个姿态文件是一个 JSON 文件，例如 `standing.json`：

```json
{
  "name": "standing",
  "displayName": "站立",
  "head": [0, 0, 0],
  "hat": [0, 0, 0],
  "body": [0, 0, 0],
  "rightArm": [0, 0, 0],
  "leftArm": [0, 0, 0],
  "rightLeg": [0, 0, 0],
  "leftLeg": [0, 0, 0]
}
```

### 字段说明

- **name**: 姿态名称（必需，用于在代码中引用）
- **displayName**: 显示名称（可选，用于 UI 显示）
- **head**: [x, y, z] 头部旋转角度（度数）
- **hat**: [x, y, z] 帽子/头发外层旋转角度（度数）
- **body**: [x, y, z] 身体旋转角度（度数）
- **rightArm**: [x, y, z] 右臂旋转角度（度数）
- **leftArm**: [x, y, z] 左臂旋转角度（度数）
- **rightLeg**: [x, y, z] 右腿旋转角度（度数）
- **leftLeg**: [x, y, z] 左腿旋转角度（度数）

### 角度单位

所有角度使用**度数**为单位（360度制）。模组会自动将度数转换为弧度使用。

常用角度值：
- 0 度：无旋转
- 45 度：四分之一圆
- 90 度：直角
- 180 度：半圆
- -90 度：反向直角

### 姿态示例

**站立姿态（standing.json）**:
```json
{
  "name": "standing",
  "displayName": "站立",
  "head": [0, 0, 0],
  "hat": [0, 0, 0],
  "body": [0, 0, 0],
  "rightArm": [0, 0, 0],
  "leftArm": [0, 0, 0],
  "rightLeg": [0, 0, 0],
  "leftLeg": [0, 0, 0]
}
```

**坐下姿态（sitting.json）**:
```json
{
  "name": "sitting",
  "displayName": "坐下",
  "head": [0, 0, 0],
  "hat": [0, 0, 0],
  "body": [5, 0, 0],
  "rightArm": [-40, 0, 0],
  "leftArm": [-40, 0, 0],
  "rightLeg": [90, 0, 0],
  "leftLeg": [90, 0, 0]
}
```

**趴下姿态（lying.json）**:
```json
{
  "name": "lying",
  "displayName": "趴下",
  "head": [0, 0, 0],
  "hat": [0, 0, 0],
  "body": [-90, 0, 0],
  "rightArm": [90, 0, 0],
  "leftArm": [90, 0, 0],
  "rightLeg": [0, 0, 0],
  "leftLeg": [0, 0, 0]
}
```

## 3. 配置动作（Actions）

动作定义了玩偶的动态动画序列，保存在 `actions/` 目录下。动作由多个关键帧组成，关键帧之间会自动插值。

### 动作文件格式

每个动作文件是一个 JSON 文件，例如 `dance.json`：

```json
{
  "name": "dance",
  "displayName": "舞蹈",
  "mode": "LOOP",
  "looping": true,
  "keyframes": [
    {
      "tick": 20,
      "pose": {
        "name": "dance_pose_1",
        "rightArm": [0, 30, -90],
        "leftArm": [0, 30, 90]
      }
    },
    {
      "tick": 20,
      "pose": {
        "name": "dance_pose_2",
        "rightArm": [0, 30, 90],
        "leftArm": [0, 30, -90]
      }
    }
  ]
}
```

### 字段说明

- **name**: 动作名称（必需，用于标识）
- **displayName**: 显示名称（可选，用于 UI 显示，默认为 name）
- **mode**: 动作模式（可选，默认为 `ONCE`）
  - `LOOP`: 循环播放，动作结束后自动重新开始
  - `HOLD`: 保持，动作结束后保持在最后一个关键帧的姿态
  - `ONCE`: 播放一次，动作结束后停止并恢复到默认姿态
- **looping**: 是否循环播放（可选，向后兼容字段，`true` 等同于 `mode: "LOOP"`）
  - `true`: 动作会循环播放（等同于 `mode: "LOOP"`）
  - `false`: 动作播放一次后停止（等同于 `mode: "ONCE"`）
- **keyframes**: 关键帧数组
  - **tick**: 从上一个关键帧到当前关键帧的持续时间（相对时间，游戏 tick，1 tick = 0.05 秒）
    - 第一个关键帧的 `tick` 表示从玩偶当前姿态过渡到第一个关键帧姿态需要的时间
    - 后续关键帧的 `tick` 表示从前一个关键帧过渡到当前关键帧需要的时间
    - `tick: 0` 表示立即切换，不进行插值过渡
  - **pose**: 该关键帧的姿态
    - 可以是字符串：引用已定义的姿态文件（如 `"standing"` 或 `"sitting"`）
    - 可以是对象：内联定义姿态（只需指定需要改变的部分）

### 姿态引用 vs 内联定义

**引用已定义的姿态**（推荐，便于复用）:
```json
{
  "tick": 0,
  "pose": "standing"
}
```
或
```json
{
  "tick": 5,
  "pose": "sitting"
}
```

**内联定义姿态**（只指定需要改变的部分）:
```json
{
  "tick": 10,
  "pose": {
    "name": "custom_pose",
    "rightArm": [-90, 0, 0],
    "leftArm": [90, 0, 0]
  }
}
```

使用内联定义时，未指定的身体部位会使用前一个关键帧的值或默认值。如果内联定义的姿态需要完整定义所有部位，可以包含所有字段（如 `head`、`body`、`rightArm`、`leftArm`、`rightLeg`、`leftLeg` 等）。

### 动作示例

**挥手动作（wave.json）**:
```json
{
  "name": "wave",
  "displayName": "挥手",
  "mode": "ONCE",
  "looping": false,
  "keyframes": [
    {"tick": 0, "pose": "standing"},
    {
      "tick": 5,
      "pose": {
        "name": "wave_up",
        "rightArm": [-90, 0, 0]
      }
    },
    {"tick": 10, "pose": "standing"}
  ]
}
```
说明：从站立姿态开始，5 tick 后抬起右臂，再 10 tick 后回到站立姿态。总时长 15 tick（0.75 秒）。

**跳舞动作（dance.json）**:
```json
{
  "name": "dance",
  "displayName": "舞蹈",
  "mode": "LOOP",
  "looping": true,
  "keyframes": [
    {
      "tick": 20,
      "pose": {
        "name": "dance_pose_1",
        "head": [0, 0, 0],
        "body": [0, 0, 0],
        "rightArm": [0, 30, -90],
        "leftArm": [0, 30, 90],
        "rightLeg": [0, 0, 0],
        "leftLeg": [0, 0, 0]
      }
    },
    {
      "tick": 20,
      "pose": {
        "name": "dance_pose_2",
        "head": [0, 0, 0],
        "body": [0, 0, 0],
        "rightArm": [0, 30, 90],
        "leftArm": [0, 30, -90],
        "rightLeg": [0, 0, 0],
        "leftLeg": [0, 0, 0]
      }
    }
  ]
}
```
说明：循环播放，每个姿态持续 20 tick（1 秒），两个姿态交替，总时长 40 tick（2 秒）。手臂角度使用三个轴 `[x, y, z]` 定义。

**坐下动作（sit.json）**:
```json
{
  "name": "sit",
  "displayName": "坐下",
  "mode": "HOLD",
  "looping": false,
  "keyframes": [
    {"tick": 0, "pose": "standing"},
    {"tick": 5, "pose": "sitting"}
  ]
}
```
说明：从站立姿态开始，5 tick 后过渡到坐下姿态。使用 `mode: "HOLD"` 表示动作结束后保持在坐下姿态。注意这里直接引用了已定义的 `"sitting"` 姿态，而不是内联定义。

## 4. 常见角度参考

所有角度使用 `[x, y, z]` 格式，表示三个轴的旋转角度（度数）：
- **x 轴（俯仰）**: 前后旋转（正值向前，负值向后）
- **y 轴（偏航）**: 左右旋转（正值向右，负值向左）
- **z 轴（翻滚）**: 扭转旋转（正值顺时针，负值逆时针）

### 手臂角度

- **自然下垂**: `[0, 0, 0]`
- **向前 40 度**: `[-40, 0, 0]`
- **向上 90 度**: `[-90, 0, 0]`
- **水平向右 90 度**: `[0, 90, 0]`
- **水平向左 90 度**: `[0, -90, 0]`
- **侧向展开并扭转**: `[0, 30, -90]`（向右展开 30 度，同时扭转 -90 度）

### 腿部角度

- **伸直**: `[0, 0, 0]`
- **弯曲 90 度**: `[90, 0, 0]`

### 身体角度

- **直立**: `[0, 0, 0]`
- **向前倾斜 5 度**: `[5, 0, 0]`
- **向前倾斜 90 度（趴下）**: `[-90, 0, 0]`

## 5. 使用提示

1. **重新加载资源**: 修改配置文件后，按 `F3+T` 重新加载资源包，无需重启游戏
2. **关键帧插值**: 系统会自动在关键帧之间进行线性插值，使动作更流畅
   - 动作开始时会从玩偶的当前姿态平滑过渡到第一个关键帧
   - 关键帧之间会自动进行线性插值
3. **动作模式**: 使用 `mode` 字段控制动作结束后的行为
   - `LOOP`: 适合循环动画（如舞蹈、跑步）
   - `HOLD`: 适合过渡动作（如坐下、躺下）
   - `ONCE`: 适合一次性动作（如挥手、跳跃）
4. **循环动作**: 设置 `mode: "LOOP"` 或 `looping: true` 可以让动作循环播放
5. **姿态复用**: 可以在动作中引用已定义的姿态文件（如 `"pose": "sitting"`），避免重复定义
6. **部分姿态**: 在内联定义姿态时，只需指定需要改变的部分，未指定的部位会继承前一个关键帧的值
7. **时间控制**: 使用 `tick` 值控制动作的节奏
   - `tick` 表示从上一个关键帧到当前关键帧的持续时间（相对时间）
   - 1 tick = 0.05 秒（20 tick = 1 秒）
   - 第一个关键帧的 `tick` 表示从玩偶当前姿态过渡到第一个关键帧需要的时间
   - `tick: 0` 表示立即切换，不进行插值
8. **平滑循环**: 循环动作（`LOOP`）在播放完最后一个关键帧后会平滑过渡回第一个关键帧

## 6. 注意事项

- 所有角度单位都是**度数**（360度制），模组会自动转换为弧度使用
- 角度使用 `[x, y, z]` 三轴格式，分别表示俯仰、偏航、翻滚
- JSON 文件必须使用 UTF-8 编码
- 姿态文件中的 `hat` 通常与 `head` 保持相同的旋转值
- 如果修改了默认文件，建议先备份
- 皮肤文件必须是有效的 PNG 格式，且符合 Minecraft 皮肤规范
- 负数角度表示反向旋转（例如 `-90` 表示反向 90 度）
- **tick 字段是相对时间**：表示从前一个关键帧到当前关键帧的持续时间，不是绝对时间点
- 第一个关键帧的 `tick` 表示从玩偶当前姿态过渡到第一个关键帧需要的时间
- 使用 `mode` 字段可以更精确地控制动作结束后的行为，比 `looping` 字段更灵活

## 7. 获取帮助

如有问题或需要更多帮助，请查看模组的 GitHub 仓库或相关文档。

---

*本文档由 Player Doll Addon 模组自动生成*
